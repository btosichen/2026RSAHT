<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å¸«é´è˜ï¼è¼ªæ›¿åˆ¶åº¦æ¯”è¼ƒå¹³å°ï¼ˆå…­æ ¡æ¯”è¼ƒï¼‰</title>
    <style>
        /* --- CSS Reset & Variables (Vivid/Lively Theme) --- */
        :root {
            /* ä¸»è‰²èª¿ï¼šæ´»æ½‘çš„è—ç¶ è‰²èˆ‡æš–æ©˜è‰² */
            --primary-gradient: linear-gradient(135deg, #00C6FB 0%, #005BEA 100%);
            --header-text: #ffffff;
            
            --bg-color: #f0f4f8; /* æ·ºç°è—èƒŒæ™¯ */
            --card-bg: #ffffff;
            
            --text-main: #2d3436;
            --text-light: #636e72;
            --border-color: #dfe6e9;

            /* å­¸æ ¡ä»£è¡¨è‰² (æ›´é®®è±”) */
            --color-tianmu: #ff7675;   /* æŸ”å’Œç´… */
            --color-lanya: #00b894;    /* è–„è·ç¶  */
            --color-jingxing: #fdcb6e; /* æ˜äº®é»ƒ */
            --color-xingya: #a29bfe;   /* è–°è¡£è‰ç´« */
            --color-heping: #00cec9;   /* äº®é’è‰² (å’Œå¹³) */
            --color-datong: #54a0ff;   /* å¯¶è—è‰² (å¤§åŒ) */

            /* åŠŸèƒ½è‰² */
            --accent-color: #0984e3;
            --badge-bg: #e1f5fe;
            --badge-text: #0277bd;
            
            /* é™°å½±å„ªåŒ– */
            --shadow-sm: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 13px 27px -5px rgba(50, 50, 93, 0.25), 0 8px 16px -8px rgba(0, 0, 0, 0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif; }
        
        body { background-color: var(--bg-color); color: var(--text-main); line-height: 1.6; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- Header --- */
        header {
            background: var(--primary-gradient);
            color: var(--header-text);
            padding: 1.2rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        header h1 { 
            font-size: 1.6rem; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .subtitle { 
            font-size: 0.9rem; 
            background: rgba(255,255,255,0.2); 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-weight: normal; 
            display: none; 
            backdrop-filter: blur(5px);
        }
        @media(min-width: 768px) { .subtitle { display: inline-block; } }

        .search-box input {
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid transparent;
            width: 220px;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .search-box input:focus { 
            width: 320px; 
            outline: none; 
            border-color: #fff; 
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3); 
        }

        /* --- Layout --- */
        .container { display: flex; flex: 1; flex-direction: column; }
        @media(min-width: 992px) { .container { flex-direction: row; } }

        /* --- Sidebar --- */
        .sidebar {
            background: white;
            padding: 2rem;
            width: 100%;
            border-bottom: 1px solid var(--border-color);
        }
        @media(min-width: 992px) {
            .sidebar { 
                width: 260px; 
                border-right: 1px solid var(--border-color); 
                border-bottom: none; 
                position: sticky; 
                top: 75px; 
                height: calc(100vh - 75px); 
                overflow-y: auto; 
            }
        }

        .filter-title { 
            font-weight: 800; 
            margin-bottom: 0.8rem; 
            color: #2d3436; 
            display: block; 
            font-size: 1rem;
            letter-spacing: 0.5px;
        }
        
        .filter-label { 
            display: flex; 
            align-items: center; 
            margin-bottom: 0.8rem; 
            cursor: pointer; 
            padding: 8px 12px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .filter-label:hover { background: #f1f2f6; }
        .filter-label input { margin-right: 12px; accent-color: var(--accent-color); transform: scale(1.2); }
        
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 1.5rem; }
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary { 
            background: var(--primary-gradient); 
            color: white; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .btn-outline { 
            background: white; 
            border: 2px solid #dfe6e9; 
            color: #636e72; 
        }
        .btn-outline:hover { 
            border-color: var(--accent-color); 
            color: var(--accent-color); 
            background: #fdfdfd;
        }
        
        /* --- Main Content --- */
        .main-content { flex: 1; padding: 2.5rem; overflow-x: hidden; }
        
        /* --- Controls --- */
        .view-controls { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 2rem; 
            align-items: center; 
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow-sm);
        }
        
        .toggle-switch { display: flex; background: #f1f2f6; border-radius: 25px; padding: 4px; }
        .toggle-btn {
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            border: none;
            background: transparent;
            color: #636e72;
            font-weight: 600;
            transition: all 0.3s;
        }
        .toggle-btn.active { 
            background: white; 
            color: var(--accent-color); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }

        /* --- Sections --- */
        .section-header {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 1.5rem;
            padding-left: 15px;
            border-left: 5px solid var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /* --- Cards --- */
        .grid-4 { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.8rem; 
            margin-bottom: 3rem; 
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            padding: 1.8rem;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid #f0f0f0;
            position: relative;
            overflow: hidden;
        }
        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }
        
        /* Colorful top borders */
        .card.tianmu { border-top: 6px solid var(--color-tianmu); }
        .card.lanya { border-top: 6px solid var(--color-lanya); }
        .card.jingxing { border-top: 6px solid var(--color-jingxing); }
        .card.xingya { border-top: 6px solid var(--color-xingya); }
        .card.heping { border-top: 6px solid var(--color-heping); }
        .card.datong { border-top: 6px solid var(--color-datong); }

        .card h3 { 
            margin-bottom: 1rem; 
            font-size: 1.25rem; 
            display: flex; 
            justify-content: space-between;
            align-items: center;
        }
        /* Specific header colors */
        .card.tianmu h3 { color: var(--color-tianmu); }
        .card.lanya h3 { color: var(--color-lanya); }
        .card.jingxing h3 { color: #f39c12; }
        .card.xingya h3 { color: #6c5ce7; }
        .card.heping h3 { color: #00b5b5; }
        .card.datong h3 { color: #2e86de; }

        .card-content { font-size: 1rem; color: #555; }
        
        /* --- Badges --- */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            background: #f1f2f6;
            color: #636e72;
            margin-bottom: 6px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .badge.highlight { background: #fff3cd; color: #856404; }
        .badge.risk { background: #f8d7da; color: #721c24; }
        .badge.bonus { background: #d4edda; color: #155724; }
        .badge.info { background: #e1f5fe; color: #0277bd; }

        /* --- Table Styling --- */
        .table-wrapper { 
            overflow-x: auto; 
            margin-bottom: 3rem; 
            border-radius: 16px; 
            box-shadow: var(--shadow-sm); 
            background: white;
            border: 1px solid #eee;
        }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        
        th { 
            background-color: #f8f9fa; 
            color: #2d3436; 
            padding: 16px;
            font-weight: 700;
            text-align: left;
            border-bottom: 2px solid #eee;
        }
        td { 
            padding: 14px 16px; 
            border-bottom: 1px solid #f1f2f6; 
            color: #555;
            vertical-align: top;
        }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #fcfcfc; }
        
        .score-val { font-weight: bold; font-size: 1.1rem; }
        
        /* --- Summary Cards (Colorful) --- */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
        .summary-card { 
            border-radius: 16px; 
            padding: 1.5rem; 
            color: white; 
            box-shadow: var(--shadow-sm);
        }
        .summary-card.tianmu-sum { background: linear-gradient(135deg, #ff7675 0%, #d63031 100%); }
        .summary-card.lanya-sum { background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); }
        .summary-card.jingxing-sum { background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%); }
        .summary-card.xingya-sum { background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%); }
        .summary-card.heping-sum { background: linear-gradient(135deg, #00cec9 0%, #0984e3 100%); }
        .summary-card.datong-sum { background: linear-gradient(135deg, #54a0ff 0%, #2e86de 100%); }
        
        .summary-card h3 { color: white; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }
        .summary-card .card-content { color: rgba(255,255,255,0.95); font-weight: 500; }

        /* --- Utilities --- */
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <h1>
            <span>ğŸ«</span> 
            å°å¸«é´è˜åˆ¶åº¦æ¯”è¼ƒ
            <span class="subtitle">å…­æ ¡åˆ†æ</span>
        </h1>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="æœå°‹ï¼šç©åˆ†ã€å…å…¼ã€çå‹µ...">
        </div>
    </header>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="filter-group">
                <span class="filter-title">é¡¯ç¤ºå…§å®¹</span>
                <label class="filter-label"><input type="checkbox" checked value="common" class="section-filter"> âš–ï¸ å…±åŒæ³•æºèˆ‡åŸå‰‡</label>
                <label class="filter-label"><input type="checkbox" checked value="diff" class="section-filter"> âš¡ é—œéµå·®ç•°æ¯”è¼ƒ</label>
                <label class="filter-label"><input type="checkbox" checked value="features" class="section-filter"> ğŸŒŸ å„æ ¡ç‰¹è‰²æ¢æ¬¾</label>
                <label class="filter-label"><input type="checkbox" checked value="score" class="section-filter"> ğŸ”¢ ç©åˆ†è¨ˆç®—è¡¨</label>
                <label class="filter-label"><input type="checkbox" checked value="summary" class="section-filter"> ğŸ’¡ ç¸½çµåˆ†æ</label>
            </div>
            
            <div class="filter-group">
                <span class="filter-title">è³‡æ–™æ“ä½œ</span>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="exportCSV()">ğŸ“Š åŒ¯å‡ºç©åˆ† CSV</button>
                    <button class="btn btn-outline" onclick="exportJSON()">ğŸ’¾ ä¸‹è¼‰ JSON</button>
                </div>
            </div>

            <div style="margin-top: auto; padding-top: 2rem; font-size: 0.8rem; color: #b2bec3;">
                <p>è³‡æ–™æ›´æ–°ï¼š2026/01/15</p>
                <p>ä¾†æºï¼šå„æ ¡é´è˜è¾¦æ³•</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainDisplay">
            
            <!-- Controls -->
            <div class="view-controls">
                <h2 style="font-size: 1.2rem; color: #2d3436; margin:0;">ğŸ“Š æ¯”è¼ƒå„€è¡¨æ¿</h2>
                <div class="toggle-switch">
                    <button class="toggle-btn active" onclick="setMode('compare')">å¿«é€Ÿæ¯”è¼ƒ</button>
                    <button class="toggle-btn" onclick="setMode('school')">é€æ ¡æª¢è¦–</button>
                </div>
            </div>

            <!-- 1. Summary Section (Highlights) -->
            <section id="section-summary">
                <div class="section-header">
                    <span>ğŸ’¡ åˆ¶åº¦åˆ†æç¸½çµ</span>
                </div>
                <div class="summary-grid">
                    <!-- Injected by JS -->
                </div>
            </section>

            <!-- 2. Common Section -->
            <section id="section-common">
                <div class="section-header">
                    <span>âš–ï¸ å…±åŒè¦ç¯„ (å…¨æ ¡é©ç”¨)</span>
                </div>
                <div class="card" style="margin-bottom: 2rem; border-top: 4px solid #74b9ff;">
                    <div class="card-content" id="common-content">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </section>

            <!-- 3. Differences Section -->
            <section id="section-diff">
                <div class="section-header">
                    <span>âš¡ é—œéµå·®ç•°</span>
                </div>
                <div class="grid-4" id="diff-grid">
                    <!-- Injected by JS -->
                </div>
            </section>

            <!-- 4. Unique Features Section -->
            <section id="section-features">
                <div class="section-header">
                    <span>ğŸŒŸ ç‰¹è‰²èˆ‡é¢¨éšªæç¤º</span>
                </div>
                <div class="grid-4" id="features-grid">
                    <!-- Injected by JS -->
                </div>
            </section>

            <!-- 5. Score Table Section -->
            <section id="section-score">
                <div class="section-header">
                    <span>ğŸ”¢ ç©åˆ†è¨ˆç®—å°ç…§è¡¨</span>
                    <div>
                        <button class="btn btn-outline" style="font-size:0.8rem; padding: 4px 12px; border-radius:15px;" onclick="toggleScoreDetail()">åˆ‡æ›ï¼šæ‘˜è¦/è©³ç´°</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table id="scoreTable">
                        <!-- Injected by JS -->
                    </table>
                </div>
            </section>

        </main>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA MODEL (Updated with Xingya and corrected details) ---
        const initialData = {
            common: [
                "<strong>æ³•æºä¾æ“šï¼š</strong>å‡ä¾æ“šã€Šæ•™å¸«æ³•ã€‹ç¬¬32æ¢æˆ–ç¬¬17æ¢ï¼Œå¼·èª¿æ•™å¸«æ“”ä»»å°å¸«ä¹‹ç¾©å‹™ã€‚",
                "<strong>é´è˜é †ä½ï¼š</strong>æ™®éæ¡ã€Œè‡ªé¡˜è€…å„ªå…ˆã€ï¼Œåé¡ä¸è¶³æ™‚ä¾ç©åˆ†ï¼ˆä½è€…å„ªå…ˆï¼‰æˆ–æŠ½ç±¤æ±ºå®šã€‚",
                "<strong>ä»»æœŸåˆ¶åº¦ï¼š</strong>åŸå‰‡ä¸Šä¸‰å¹´ä¸€ä»»ï¼Œä»¥æ¥ç­è‡³è©²ç­ç•¢æ¥­ç‚ºåŸå‰‡ï¼Œç¶­è­·ç¶“ç‡Ÿé€£çºŒæ€§ã€‚",
                "<strong>çµ„ç¹”ç”³è¦†ï¼š</strong>çš†è¨­æœ‰ã€Œé´è˜/è¼ªæ›¿å§”å“¡æœƒã€ï¼ˆå«è¡Œæ”¿ã€æ•™å¸«ã€å®¶é•·ä»£è¡¨ï¼‰ï¼Œä¸¦æä¾›æ›¸é¢ç”³è¦†æ©Ÿåˆ¶ã€‚"
            ],
            schools: {
                xingya: {
                    id: "xingya",
                    name: "èˆˆé›…åœ‹ä¸­",
                    classCount: "æ™®é€šç­45ç­ã€ç‰¹æ®Šç­5ç­ã€è³‡è³¦å„ªç•°ç­2ç­ã€å­¸ç¿’è³‡æºç­1ç­",
                    color: "#a29bfe", // Lavender
                    diff: {
                        committee: "21 äºº (æ¬¡å¤š)",
                        lookback: "ä¾è¾¦æ³•è¦å®š",
                        exemption: "å¹´æ»¿ 58 æ­²æˆ–å·²ç”³è«‹é€€ä¼‘è€…"
                    },
                    features: [
                        { type: "badge", text: "è©³ç›¡ä»£ç†è¨ˆåˆ†", desc: "ä»£ç†å°å¸«æ¯ 15 æ—¥ +0.1 åˆ†ï¼Œè¨ˆç®—æ¥µç‚ºç²¾ç´°ã€‚" },
                        { type: "badge", text: "æ¯”è³½æŒ‡å°çå‹µ", desc: "çŸ­æœŸå°å¤–æ¯”è³½æŒ‡å°ç´¯ç© 50 æ—¥ +0.5 åˆ†ã€‚" },
                        { type: "risk", text: "å°ˆä»»è² å‘æ‰£åˆ†", desc: "å°ˆä»»æ•™å¸«æ¯å­¸å¹´ -3 åˆ† (æ¯å­¸æœŸ -1.5)ï¼ŒåŠ é€Ÿè¼ªæ›¿ã€‚" }
                    ],
                    summary: "è¨ˆåˆ†ç²¾ç´°ï¼Œå°ä»£ç†èˆ‡æŒ‡å°çµ¦äºˆæ˜ç¢ºé‡åŒ–çå‹µï¼›é‡å°å°ˆä»»æ•™å¸«è¨­æœ‰æ‰£åˆ†æ©Ÿåˆ¶ã€‚",
                    scores: {
                        homeroom: 1,
                        director: 2,
                        chief: 1.5,
                        admin: 1,
                        subject: -3, 
                        special: "æ¥ä»»ç•¢æ¥­ç­+1",
                        sub: "æ¯15æ—¥ +0.1",
                        negative: "ç„¡"
                    }
                },
                tianmu: {
                    id: "tianmu",
                    name: "å¤©æ¯åœ‹ä¸­",
                    classCount: "æ™®é€šç­53ç­ã€è³‡æºç­2ç­ã€å­¸å›°ç­1ç­ã€è³‡å„ªç­1ç­",
                    color: "#ff7675", // Red
                    diff: {
                        committee: "25 äºº (æœ€å¤š)",
                        lookback: "ä¾è¾¦æ³•è¦å®š",
                        exemption: "å‰ä¸€å¹´åº¦é•·å‡è€…ï¼Œå›æ­¸å„ªå…ˆæ“”ä»»"
                    },
                    features: [
                        { type: "badge", text: "å‰¯å°å¸«åˆ¶", desc: "è¨­å‰¯å°å¸«åˆ¶ï¼Œæ˜ç¢ºä»£ç†é †ä½èˆ‡è²¬ä»»ã€‚" },
                        { type: "risk", text: "è² å‘æ‰£åˆ†", desc: "åœ¨è·é€²ä¿®ã€è«‹é•·å‡æ¯å­¸æœŸ -0.5 åˆ†ã€‚" },
                        { type: "highlight", text: "ä¸­é€”æ¥ç­çå‹µ", desc: "ä¸­é€”æ¥ 8ã€9 å¹´ç´šæ¯å­¸æœŸ +0.5 åˆ†ã€‚" }
                    ],
                    summary: "å‚¾å‘å¾®è§€ç®¡ç†ï¼Œå¼·èª¿å…¬å¹³æ€§ï¼Œé€éã€Œæœªæœå‹™å³æ‰£åˆ†ã€æ©Ÿåˆ¶ç¶­æŒé‹ä½œã€‚",
                    scores: {
                        homeroom: 1,
                        director: 2,
                        chief: 1.5,
                        admin: 1,
                        subject: 0,
                        special: "æ¥8/9å¹´ç´š +0.5/å­¸æœŸ",
                        sub: "æ»¿120æ—¥è¨ˆ0.5",
                        negative: "é€²ä¿®/é•·å‡ -0.5"
                    }
                },
                lanya: {
                    id: "lanya",
                    name: "è˜­é›…åœ‹ä¸­",
                    classCount: "æ™®é€šç­44ç­ã€ç‰¹æ•™ç­2ç­ã€å­¸ç¿’è³‡æºç­3ç­ã€è³‡å„ªç­2ç­ã€å­¸å›°ç­1ç­",
                    color: "#00b894", // Green
                    diff: {
                        committee: "13-14 äºº",
                        lookback: "æœ€è¿‘ 10 å¹´",
                        exemption: "æ‡·å­•å¥³æ€§æ•™å¸«å„ªå…ˆå…å…¼"
                    },
                    features: [
                        { type: "bonus", text: "çºŒä»»é«˜é¡çå‹µ", desc: "ä»»æ»¿ä¸‰å¹´çºŒä»»+1ï¼Œå…­å¹´çºŒä»»+2ï¼Œé¼“å‹µä¹…ä»»ã€‚" },
                        { type: "badge", text: "ç‰¹æ®Šè·å‹™æ¡è¨ˆ", desc: "åˆä½œç¤¾ç†äº‹ä¸»å¸­ã€è³‡å„ªç­å°å¸«ç´å…¥è¨ˆåˆ†ã€‚" },
                        { type: "highlight", text: "é«˜ç©åˆ†èª˜å› ", desc: "ä¸»ä»»3åˆ†ã€çµ„é•·2.5åˆ†ï¼Œåˆ†å€¼å…¨æ ¡æœ€é«˜ã€‚" }
                    ],
                    summary: "åˆ†å€¼æœ€ç‚ºæ…·æ…¨ï¼Œé€éé«˜ç©åˆ†èˆ‡éšæ¢¯å¼çå‹µå¸å¼•ä¸¦ç©©å®šå°å¸«äººåŠ›ã€‚",
                    scores: {
                        homeroom: 2,
                        director: 3,
                        chief: 2.5,
                        admin: 1,
                        subject: 0,
                        special: "çºŒä»»ä¸€å±†+1/äºŒå±†+2",
                        sub: "æ»¿æœˆæŒ‰æ¯”ä¾‹(1/12)",
                        negative: "ç„¡"
                    }
                },
                jingxing: {
                    id: "jingxing",
                    name: "æ™¯èˆˆåœ‹ä¸­",
                    classCount: "æ™®é€šç­42ç­ã€èº«éšœ2ç­ã€è³‡å„ª1ç­ã€è³‡æºç­1ç­",
                    color: "#fdcb6e", // Yellow
                    diff: {
                        committee: "13-14 äºº",
                        lookback: "æœ€è¿‘ 6 å¹´",
                        exemption: "é™¤ä¸å¯æŠ—åŠ›ï¼Œä¸å¾—ç„¡æ•…ä¸­é€”è¾­ä»»"
                    },
                    features: [
                        { type: "risk", text: "å“¡é¡é€£å‹•", desc: "é€£çºŒç·©ä»»å…©æ¬¡ï¼Œæ¸›ç­æ™‚å„ªå…ˆåˆ—ä¸çºŒè˜åƒè€ƒã€‚" },
                        { type: "badge", text: "è¡Œæ”¿å¥‘ç´„", desc: "å¼·å‹¢ç®¡ç†ï¼Œå¼·èª¿ä¾ç´„å±¥è¡Œç¾©å‹™ã€‚" },
                        { type: "badge", text: "é½Šä¸€åŒ–è¨ˆåˆ†", desc: "å°å¸«ã€ä¸»ä»»ã€çµ„é•·ç©åˆ†çš†ç‚º 1 åˆ†ã€‚" }
                    ],
                    summary: "æ¡é½Šä¸€åŒ–è¨ˆåˆ†ç­–ç•¥ï¼Œç®¡ç†é‡å¿ƒåœ¨æ–¼åš´æ ¼çš„ç·©ä»»é™åˆ¶èˆ‡å“¡é¡é€£å‹•ã€‚",
                    scores: {
                        homeroom: 1,
                        director: 1,
                        chief: 1,
                        admin: 1,
                        subject: 0,
                        special: "é€£çºŒæ“”ä»»å…­å¹´ +1",
                        sub: "æœªç‰¹åˆ¥è¨»æ˜",
                        negative: "ç„¡"
                    }
                },
                heping: {
                    id: "heping",
                    name: "å’Œå¹³é«˜ä¸­(åœ‹)",
                    classCount: "ç´„ 18 ç­",
                    color: "#00cec9", // Teal
                    diff: {
                        committee: "16 äºº (å«é ˜åŸŸä»£è¡¨)",
                        lookback: "åˆ°æ ¡ä»»è·èµ·ç®— (ç¸½ç©åˆ†)",
                        exemption: "é‡å¤§å‚·ç—…ã€æ‡·å­•å±éšªã€å±†é½¡é€€ä¼‘"
                    },
                    features: [
                        { type: "info", text: "é ˜åŸŸé…é¡åˆ¶", desc: "ä¾åœ‹/è‹±/æ•¸/ç¤¾/è‡ª/è—/å¥ ä¸ƒå¤§é ˜åŸŸæ¯”ä¾‹é´é¸ã€‚" },
                        { type: "bonus", text: "ä¸­é€”æ¥ä»»çå‹µ", desc: "ä¸­é€”æ¥ç­ï¼Œæ¯æ¬¡é¡å¤–åŠ  0.5 åˆ†ã€‚" },
                        { type: "highlight", text: "ä»£ç†æ—¥è¨ˆåˆ†", desc: "ä»£ç†å°å¸«æ»¿1æ—¥(8H)è¨ˆ0.01åˆ† (ä¸Šé™0.75)ã€‚" }
                    ],
                    summary: "æ¡é ˜åŸŸé…é¡å¹³è¡¡å¸«è³‡ï¼Œç©åˆ†æ¡è¨ˆå…¨æ ¡å¹´è³‡ï¼Œå¼·èª¿ä¹…ä»»èˆ‡è¼ªæ›¿çš„å¹³è¡¡ã€‚",
                    scores: {
                        homeroom: 1.5,
                        director: 3,
                        chief: 2,
                        admin: "0.4", // mapped to club/team
                        subject: 0,
                        special: "ä¸­é€”æ¥ç­+0.5/æ¬¡",
                        sub: "0.01/æ—¥ (ä¸Šé™0.75)",
                        negative: "ç„¡"
                    }
                },
                datong: {
                    id: "datong",
                    name: "å¤§åŒé«˜ä¸­(åœ‹)",
                    classCount: "ç´„ 18 ç­",
                    color: "#54a0ff", // Blue
                    diff: {
                        committee: "å…¨é«”åœ‹ä¸­éƒ¨æ•™å¸« (å…¨å“¡åˆ¶)",
                        lookback: "åˆ°æ ¡ä»»è·èµ·ç®— (ç¸½ç©åˆ†)",
                        exemption: "é€£çºŒä»»å°å¸«3å¹´ã€è¡Œæ”¿å¸ä»»3å¹´"
                    },
                    features: [
                        { type: "info", text: "å…¨å“¡å§”å“¡åˆ¶", desc: "å°å¸«è¼ªæ›¿å§”å“¡æœƒåŒ…å«å…¨é«”åœ‹ä¸­éƒ¨æ­£å¼æ•™å¸«ã€‚" },
                        { type: "risk", text: "å°ˆä»»æ‰£åˆ†", desc: "å°ˆä»»æ•™å¸«æ¯å­¸å¹´ -2 åˆ† (è‡ª98å­¸å¹´åº¦å¯¦æ–½)ã€‚" },
                        { type: "bonus", text: "ä¸­é€”æ¥ä»»çå‹µ", desc: "ä¸­é€”æ¥ä»»å°å¸«ç¬¬ä¸€å­¸æœŸé¡å¤– +0.5 åˆ†ã€‚" }
                    ],
                    summary: "æ¡å…¨å“¡å§”å“¡åˆ¶ï¼Œå°å°ˆä»»æ•™å¸«è¨­æœ‰æ‰£åˆ†æ©Ÿåˆ¶ (-2åˆ†) ä»¥åŠ é€Ÿè¼ªæ›¿ï¼Œå¼·èª¿å…¨æ ¡åƒèˆ‡ã€‚",
                    scores: {
                        homeroom: 1,
                        director: 2,
                        chief: 1.5,
                        admin: 0.5,
                        subject: -2,
                        special: "ä¸­é€”æ¥ä»»é¦–å­¸æœŸ+0.5",
                        sub: "å­¸å‹™è™•å”èª¿/ä¾ç©åˆ†",
                        negative: "ç„¡"
                    }
                }
            }
        };

        // ç‹€æ…‹ç®¡ç†
        let appData = JSON.parse(JSON.stringify(initialData));
        let showScoreDetail = false;
        let currentMode = 'compare';

        // --- DOM ELEMENTS ---
        const mainDisplay = document.getElementById('mainDisplay');
        const searchInput = document.getElementById('searchInput');
        const sectionFilters = document.querySelectorAll('.section-filter');

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            renderAll();
            setupEventListeners();
        });

        function setupEventListeners() {
            searchInput.addEventListener('input', (e) => {
                filterContent(e.target.value.toLowerCase());
            });

            sectionFilters.forEach(cb => {
                cb.addEventListener('change', () => {
                    const sectionId = 'section-' + cb.value;
                    const el = document.getElementById(sectionId);
                    if(el) {
                        if(cb.checked) el.classList.remove('hidden');
                        else el.classList.add('hidden');
                    }
                });
            });
        }

        // --- RENDER FUNCTIONS ---
        function renderAll() {
            renderSummary();
            renderCommon();
            renderDiff();
            renderFeatures();
            renderScoreTable();
        }

        function renderSummary() {
            const container = document.querySelector('.summary-grid');
            let html = '';
            
            // Order: Xingya, Tianmu, Lanya, Jingxing, Heping, Datong
            ['xingya', 'tianmu', 'lanya', 'jingxing', 'heping', 'datong'].forEach(key => {
                const s = appData.schools[key];
                html += `
                    <div class="summary-card ${key}-sum searchable-item" data-text="${s.name} ç¸½çµ">
                        <div style="margin-bottom:12px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 10px;">
                            <h3 style="margin:0 0 8px 0; border:none; color:white;">${s.name}</h3>
                            <div style="font-size:0.85rem; background:rgba(0,0,0,0.15); padding:6px 10px; border-radius:8px; line-height:1.4;">
                                <span style="opacity:0.8">è¦æ¨¡ï¼š</span>${s.classCount}
                            </div>
                        </div>
                        <p class="card-content" style="color:white;">${s.summary}</p>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function renderCommon() {
            const container = document.getElementById('common-content');
            const list = appData.common.map(item => `
                <li style="margin-bottom:10px; display:flex; align-items:start;">
                    <span style="color:var(--accent-color); margin-right:10px;">âœ”</span>
                    <span>${item}</span>
                </li>`
            ).join('');
            container.innerHTML = `<ul style="list-style:none;">${list}</ul>`;
        }

        function renderDiff() {
            const container = document.getElementById('diff-grid');
            let html = '';

            const fields = [
                { key: 'committee', label: 'å§”å“¡æœƒäººæ•¸' },
                { key: 'lookback', label: 'ç©åˆ†æ¡è¨ˆå¹´é™' },
                { key: 'exemption', label: 'å…å…¼/ç·©ä»»é–€æª»' }
            ];

            Object.values(appData.schools).forEach(school => {
                let content = '';
                fields.forEach(f => {
                    content += `
                        <div style="margin-bottom:12px;">
                            <strong style="font-size:0.85rem; color:#b2bec3; text-transform:uppercase; letter-spacing:1px;">${f.label}</strong>
                            <div style="color:var(--text-main); font-weight:600; font-size:1.05rem;">${school.diff[f.key] || '---'}</div>
                        </div>
                    `;
                });

                html += `
                    <div class="card ${school.id} searchable-item" data-text="${school.name} ${JSON.stringify(school.diff)}">
                        <h3>${school.name}</h3>
                        <div class="card-content">${content}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function renderFeatures() {
            const container = document.getElementById('features-grid');
            let html = '';

            Object.values(appData.schools).forEach(school => {
                let featuresHtml = school.features.map(f => {
                    const badgeClass = f.type === 'risk' ? 'risk' : (f.type === 'highlight' ? 'highlight' : (f.type === 'bonus' ? 'bonus' : (f.type === 'info' ? 'info' : '')));
                    return `
                        <div style="margin-bottom: 12px; border-left: 3px solid #eee; padding-left: 10px; padding-bottom:2px;">
                            <span class="badge ${badgeClass}">${f.text}</span>
                            <div style="font-size:0.95rem; margin-top:4px;">${f.desc}</div>
                        </div>
                    `;
                }).join('');

                html += `
                    <div class="card ${school.id} searchable-item" data-text="${school.name} features">
                        <h3>${school.name}</h3>
                        <div class="card-content">${featuresHtml}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function renderScoreTable() {
            const table = document.getElementById('scoreTable');
            const schools = Object.values(appData.schools);
            
            let rows = [
                { id: 'homeroom', label: 'å°å¸« (æ¯å­¸å¹´)' },
                { id: 'director', label: 'ä¸»ä»» (æ¯å­¸å¹´)' },
                { id: 'chief', label: 'çµ„é•· (æ¯å­¸å¹´)' },
                { id: 'admin', label: 'å”åŠ©è¡Œæ”¿/ç¤¾åœ˜' },
                { id: 'subject', label: 'å°ˆä»»æ•™å¸« (æ¯å­¸å¹´)' }
            ];

            if (showScoreDetail) {
                rows.push(
                    { id: 'special', label: 'ç‰¹æ®ŠåŠ åˆ†' },
                    { id: 'sub', label: 'ä»£ç†å°å¸«' },
                    { id: 'negative', label: 'è² å‘/æ‰£åˆ†' }
                );
            }

            // Header
            let thead = `<thead><tr><th style="width:14%">è·å‹™/é …ç›®</th>`;
            schools.forEach(s => {
                thead += `<th style="border-bottom: 3px solid ${s.color}; color:${s.color}">${s.name}</th>`;
            });
            thead += `</tr></thead>`;

            // Body
            let tbody = `<tbody>`;
            rows.forEach(r => {
                tbody += `<tr><td><strong>${r.label}</strong></td>`;
                schools.forEach(s => {
                    let val = s.scores[r.id];
                    let displayVal = val;
                    let style = "";

                    // Highlight logic
                    if (typeof val === 'number') {
                        displayVal = `<span class="score-val">${val}</span> åˆ†`;
                        if (val >= 3) style = "color: #00b894;"; // High score green
                        if (val < 0) style = "color: #d63031;"; // Negative score red
                    }
                    if (val === 0) displayVal = `<span style="color:#b2bec3">0</span>`;
                    
                    // Specific overrides for clarity
                    if (r.id === 'subject' && s.id === 'xingya') displayVal = `<span class="score-val" style="color:#d63031">-3</span> åˆ† <br><span style="font-size:0.8rem">(æ¯å­¸æœŸ-1.5)</span>`;

                    tbody += `<td style="${style}">${displayVal}</td>`;
                });
                tbody += `</tr>`;
            });
            tbody += `</tbody>`;

            table.innerHTML = thead + tbody;
        }

        // --- INTERACTION LOGIC ---

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const gridCols = mode === 'compare' ? 'repeat(auto-fit, minmax(280px, 1fr))' : '1fr';
            document.querySelectorAll('.grid-4').forEach(grid => {
                grid.style.gridTemplateColumns = gridCols;
            });
        }

        function toggleScoreDetail() {
            showScoreDetail = !showScoreDetail;
            renderScoreTable();
        }

        function filterContent(term) {
            const items = document.querySelectorAll('.searchable-item');
            items.forEach(item => {
                const text = item.getAttribute('data-text').toLowerCase();
                if(term === '' || text.includes(term)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
            
            // Filter Table Rows
            const rows = document.querySelectorAll('#scoreTable tbody tr');
            if(term) {
                rows.forEach(r => {
                    if(r.textContent.toLowerCase().includes(term)) r.style.display = '';
                    else r.style.display = 'none';
                });
            } else {
                rows.forEach(r => r.style.display = '');
            }
        }

        // --- EXPORT LOGIC ---
        function exportJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "school_comparison_2026.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function exportCSV() {
            const schools = Object.values(appData.schools);
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; 
            
            csvContent += "è·å‹™/é …ç›®," + schools.map(s => s.name).join(",") + "\n";
            
            const keys = ['homeroom', 'director', 'chief', 'admin', 'subject'];
            const labels = ['å°å¸«', 'ä¸»ä»»', 'çµ„é•·', 'å”è¡Œ', 'å°ˆä»»'];
            
            keys.forEach((k, i) => {
                let row = labels[i];
                schools.forEach(s => {
                    row += "," + (s.scores[k]);
                });
                csvContent += row + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "score_comparison_2026.csv");
            document.body.appendChild(link);
            link.click();
            link.remove();
        }
    </script>
</body>
</html>
